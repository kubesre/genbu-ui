import{u as e}from"./useDept-ca9253a3.js";import{g as a,d as l,l as d,N as t,r as s,o as u,e as o,w as i,a as n,u as r,f as m,H as c,M as p}from"./index-5da0dba2.js";import{h as f,i as g,j as h}from"./index-0cb764db.js";import{E as V,P as b}from"./regexp-251ef192.js";const v=l({__name:"AddUserModal",setup(l,{expose:v}){const{roleList:_,getRoleList:w}=function(){const e=a(!1),l=a([]),d=a(0);return{roleList:l,getRoleList:async()=>{try{e.value=!0;const a=await f();l.value=a.data.list.filter((e=>1===e.status)),d.value=a.data.total}catch(a){}finally{e.value=!1}},loading:e,total:d}}();w();const k=d((()=>_.value.map((e=>({label:e.name,value:e.code}))))),x=a(""),I=d((()=>x.value?"编辑用户":"新增用户")),U=a(!1),y=t({id:"",username:"",nickname:"",email:"",phone:"",gender:1,deptId:"",roleIds:[],address:"",disabled:!1,description:"",status:0}),j={username:[{required:!0,message:"请输入用户名"},{min:2,max:4,message:"长度在 2 - 4个字符"}],nickname:[{required:!0,message:"请输入昵称"},{min:2,max:4,message:"长度在 2 - 4个字符"}],email:[{match:V,message:"邮箱格式不正确"}],phone:[{match:b,message:"手机号格式不正确"}],deptId:[{required:!0,message:"请选择所属部门"}],roleIds:[{required:!0,message:"请选择角色"}],status:[{required:!0,message:"请选择状态"}]},{deptList:L,getDeptList:q}=e();q();v({add:()=>{x.value="",U.value=!0},edit:async e=>{x.value=e;const a=await g({id:e});Object.assign(y,a.data),U.value=!0}});const R=async()=>{try{return!!(await h(y)).data&&(p.success("模拟保存成功"),!0)}catch(e){return!1}};return(e,a)=>{const l=s("a-input"),d=s("a-form-item"),t=s("a-col"),p=s("a-row"),f=s("a-radio"),g=s("a-radio-group"),h=s("a-tree-select"),V=s("a-select"),b=s("a-textarea"),v=s("a-switch"),_=s("a-form"),w=s("a-modal");return u(),o(w,{visible:r(U),"onUpdate:visible":a[9]||(a[9]=e=>c(U)?U.value=e:null),width:600,title:r(I),"mask-closable":!1,onBeforeOk:R},{default:i((()=>[n(_,{ref:"formRef",model:r(y),rules:j,size:"medium","auto-label-width":""},{default:i((()=>[n(p,null,{default:i((()=>[n(t,{span:12},{default:i((()=>[n(d,{label:"用户名",field:"username","validate-trigger":["change","input"]},{default:i((()=>[n(l,{placeholder:"请输入用户名",modelValue:r(y).username,"onUpdate:modelValue":a[0]||(a[0]=e=>r(y).username=e)},null,8,["modelValue"])])),_:1})])),_:1}),n(t,{span:12},{default:i((()=>[n(d,{label:"昵称",field:"nickname","validate-trigger":["change","input"]},{default:i((()=>[n(l,{placeholder:"请输入昵称",modelValue:r(y).nickname,"onUpdate:modelValue":a[1]||(a[1]=e=>r(y).nickname=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),n(p,null,{default:i((()=>[n(t,{span:12},{default:i((()=>[n(d,{label:"手机号码",field:"phone","validate-trigger":["change","input"]},{default:i((()=>[n(l,{placeholder:"请输入手机号码",modelValue:r(y).phone,"onUpdate:modelValue":a[2]||(a[2]=e=>r(y).phone=e)},null,8,["modelValue"])])),_:1})])),_:1}),n(t,{span:12},{default:i((()=>[n(d,{label:"邮箱",field:"email","validate-trigger":["change","input"]},{default:i((()=>[n(l,{placeholder:"请输入邮箱",modelValue:r(y).email,"onUpdate:modelValue":a[3]||(a[3]=e=>r(y).email=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),n(d,{label:"性别",field:"gender"},{default:i((()=>[n(g,{modelValue:r(y).gender,"onUpdate:modelValue":a[4]||(a[4]=e=>r(y).gender=e)},{default:i((()=>[n(f,{value:1},{default:i((()=>[m("男")])),_:1}),n(f,{value:2},{default:i((()=>[m("女")])),_:1})])),_:1},8,["modelValue"])])),_:1}),n(d,{label:"所属部门",field:"deptId"},{default:i((()=>[n(h,{modelValue:r(y).deptId,"onUpdate:modelValue":a[5]||(a[5]=e=>r(y).deptId=e),data:r(L),fieldNames:{key:"id",title:"name"},placeholder:"请选择所属部门","allow-clear":"","allow-search":"",disabled:r(y).disabled},null,8,["modelValue","data","disabled"])])),_:1}),n(d,{label:"角色",field:"roleIds",disabled:r(y).disabled},{default:i((()=>[n(V,{modelValue:r(y).roleIds,"onUpdate:modelValue":a[6]||(a[6]=e=>r(y).roleIds=e),options:r(k),placeholder:"请选择所属角色",multiple:"","allow-clear":"","allow-search":{retainInputValue:!0}},null,8,["modelValue","options"])])),_:1},8,["disabled"]),n(d,{label:"描述",field:"description"},{default:i((()=>[n(b,{modelValue:r(y).description,"onUpdate:modelValue":a[7]||(a[7]=e=>r(y).description=e),"max-length":200,placeholder:"请输入描述","auto-size":{minRows:3},"show-word-limit":""},null,8,["modelValue"])])),_:1}),n(d,{label:"状态",field:"status"},{default:i((()=>[n(v,{type:"round",modelValue:r(y).status,"onUpdate:modelValue":a[8]||(a[8]=e=>r(y).status=e),"checked-value":1,"unchecked-value":0,"checked-text":"正常","unchecked-text":"禁用"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"])}}});export{v as _};
